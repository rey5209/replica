<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Join Our Team</title>

  <style>
    :root {
      --welcome-start: #1e40af;
      --welcome-end:   #60a5fa;
      --primary:       #2563eb;
      --primary-dark:  #1d4ed8;
      --success:       #10b981;
      --warning:       #f59e0b;
      --error:         #ef4444;
      --text:          #111827;
      --muted:         #6b7280;
      --bg:            #f8fafc;

      --welcome-dur:   3s;
      --fade-dur:      1s;
      --form-delay:    3.5s;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      color: var(--text);
    }

    #welcome {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--welcome-start), var(--welcome-end));
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity var(--fade-dur) ease-out;
      text-align: center;
      padding: 2rem;
    }

    #welcome h2 {
      font-size: clamp(2.8rem, 9vw, 5.2rem);
      font-weight: 800;
      letter-spacing: -0.03em;
      background: linear-gradient(90deg, #ffffff, #e0f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: pulse 3s ease-in-out infinite;
    }

    #welcome .subtitle {
      margin-top: 1rem;
      font-size: clamp(1.1rem, 4vw, 1.5rem);
      opacity: 0.92;
      max-width: 600px;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50%      { transform: scale(1.03); }
    }

    #welcome.hidden { opacity: 0; pointer-events: none; }

    .join-card {
      background: white;
      padding: clamp(2.5rem, 6vw, 3.5rem) 2.5rem;
      border-radius: 1.5rem;
      box-shadow: 0 20px 50px rgba(0,0,0,0.12);
      max-width: 560px;
      width: 92%;
      opacity: 0;
      transform: translateY(40px);
      transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .join-card.visible { opacity: 1; transform: translateY(0); }

    h1 {
      font-size: clamp(2rem, 5.5vw, 2.6rem);
      text-align: center;
      margin-bottom: 2.2rem;
      color: var(--primary);
      font-weight: 700;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .form-group {
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 0.55rem;
      font-weight: 500;
      font-size: 0.98rem;
      color: var(--muted);
    }

    input, select, textarea {
      width: 100%;
      padding: 1.05rem 1.3rem;
      border: 1px solid #d1d5db;
      border-radius: 0.9rem;
      font-size: 1.05rem;
      background: #fafafa;
      transition: all 0.2s;
    }

    select:disabled {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
    }

    input:focus, select:focus:not(:disabled), textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(37,99,235,0.12);
      background: white;
      outline: none;
    }

    textarea { min-height: 120px; resize: vertical; }

    option[data-spots="high"] { color: var(--success); }
    option[data-spots="medium"] { color: var(--warning); }
    option[data-spots="low"] { color: var(--error); }
    option:disabled { color: #9ca3af !important; }

    .file-upload {
      border: 2px dashed #cbd5e1;
      border-radius: 0.9rem;
      padding: 1.6rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s;
    }

    .file-upload:hover, .file-upload.dragover {
      border-color: var(--primary);
      background: rgba(37,99,235,0.05);
    }

    .file-info {
      margin-top: 1rem;
      padding: 0.9rem;
      background: #f1f5f9;
      border-radius: 0.7rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.96rem;
    }

    .file-info.valid   { background: rgba(16,185,129,0.1); }
    .file-info.invalid { background: rgba(239,68,68,0.1); }

    .remove-file {
      background: var(--error);
      color: white;
      border: none;
      border-radius: 50%;
      width: 26px; height: 26px;
      font-size: 1rem;
      cursor: pointer;
    }

    .error-message {
      color: var(--error);
      font-size: 0.92rem;
      margin-top: 0.45rem;
      min-height: 1.3rem;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .error-message.show { opacity: 1; }

    .input-wrapper.valid   input,
    .input-wrapper.valid   select,
    .input-wrapper.valid   textarea,
    .input-wrapper.valid   .file-upload { border-color: var(--success); }

    .input-wrapper.invalid input,
    .input-wrapper.invalid select,
    .input-wrapper.invalid textarea,
    .input-wrapper.invalid .file-upload { border-color: var(--error); }

    .submit-wrapper {
      position: relative;
      margin-top: 1rem;
    }

    button {
      width: 100%;
      padding: 1.2rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0.9rem;
      font-size: 1.12rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s;
    }

    button:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .spinner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(37,99,235,0.9);
      border-radius: 0.9rem;
      color: white;
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .spinner.active { opacity: 1; pointer-events: all; }

    .spinner::after {
      content: '';
      width: 24px; height: 24px;
      border: 3px solid white;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%,60% { transform: translateX(-6px); }
      40%,80% { transform: translateX(6px); }
    }
    .shake { animation: shake 0.45s; }
  </style>
</head>
<body>

  <div id="welcome">
    <h2>Welcome!</h2>
    <div class="subtitle">We're excited you're considering joining our team.<br>Let's build something amazing together.</div>
  </div>

  <div class="join-card" id="join-card">
    <h1>Apply to Join Us</h1>

    <form id="joinForm" action="https://formspree.io/f/mdakgeze" method="post" enctype="multipart/form-data">

      <div class="form-group input-wrapper" data-field="name">
        <label for="name">Full Name *</label>
        <input type="text" id="name" name="name" required autofocus placeholder="John Doe">
        <div class="error-message" id="name-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="email">
        <label for="email">Email Address *</label>
        <input type="email" id="email" name="email" required placeholder="jior@example.com">
        <div class="error-message" id="email-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="phone">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" placeholder="+1 (555) 123-4567">
        <div class="error-message" id="phone-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="role">
        <label for="role">Your Position *</label>
        <select id="role" name="role" required>
          <option value="" disabled selected>Select position</option>
        </select>
        <div class="error-message" id="role-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="location">
        <label for="location">Preferred Deployment Location / Country *</label>
        <select id="location" name="location" required onchange="toggleOtherLocation()">
          <option value="" disabled selected>Select country / type</option>
          <option value="Spain (On-site)">Spain (On-site)</option>
          <option value="Italy (On-site)">Italy (On-site)</option>
          <option value="France (Hybrid)">France (Hybrid)</option>
          <option value="United Kingdom (On-site)">United Kingdom (On-site)</option>
          <option value="Germany (On-site)">Germany (On-site)</option>
          <option value="Poland (On-site)">Poland (On-site)</option>
          <option value="Shanghai (On-site)">Shanghai (On-site)</option>
          <option value="Remote (Worldwide)">Remote (Worldwide)</option>
          <option value="Hybrid - Tokyo">Hybrid - Tokyo</option>
          <option value="Singapore (On-Site)">Singapore (On-Site)</option>
        </select>
        <div class="error-message" id="location-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="other-location" style="display:none;">
        <label for="other-location-input">Specify location / country</label>
        <input type="text" id="other-location-input" name="other_location" placeholder="e.g. Canada (On-site), Singapore, etc.">
        <div class="error-message" id="other-location-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="cv">
        <label for="cv">Upload CV / Resume (optional)</label>
        <div class="file-upload" id="fileDropArea">
          <input type="file" id="cv" name="cv" accept=".pdf,.doc,.docx" hidden>
          <p>Drag & drop or <strong>click to select</strong></p>
          <p style="font-size:0.88rem; color:var(--muted); margin-top:0.5rem;">Max 5 MB — PDF, DOC, DOCX</p>
        </div>
        <div class="file-info hidden" id="fileInfo">
          <span id="fileNameSize"></span>
          <button type="button" class="remove-file" id="removeFile">×</button>
        </div>
        <div class="error-message" id="cv-error"></div>
      </div>

      <div class="form-group input-wrapper" data-field="message">
        <label for="message">Why do you want to join us?</label>
        <textarea id="message" name="message" placeholder="Tell us about your motivation, experience, or what excites you..."></textarea>
        <div class="error-message" id="message-error"></div>
      </div>

      <div class="submit-wrapper">
        <button type="submit" id="submitBtn">Submit Application</button>
        <div class="spinner" id="loadingSpinner">
          <span>Sending application...</span>
        </div>
      </div>
    </form>
  </div>

  <script>
    // === CONFIG ===
    const config = {
      showWelcome: true,
      welcomeVisibleMs: 3200,
      fadeOutMs: 1000,
      formAppearDelayMs: 3800,
      maxFileSize: 5 * 1024 * 1024,
      allowedExtensions: ['pdf','doc','docx']
    };

    // === ROLE AVAILABILITY ===
    let roleSpots = {
      "Frontend Developer": 0,
      "Backend Developer": 2,
      "Fullstack Developer": 1,
      "UI/UX Designer": 1,
      "Product Manager": 1,
      "DevOps Engineer": 3
    };

    function getSpotsClass(spots) {
      if (spots >= 3) return "high";
      if (spots >= 1) return "medium";
      return "low";
    }

    function updateRoleOptions(preserveSelected = "") {
      const select = document.getElementById('role');
      const currentValue = preserveSelected || select.value;
      select.innerHTML = '<option value="" disabled selected>Select position</option>';

      Object.entries(roleSpots).forEach(([role, spots]) => {
        const option = document.createElement('option');
        option.value = role;
        option.textContent = `${role} – ${spots > 0 ? spots + '/4 left' : 'Full'}`;
        option.dataset.spots = getSpotsClass(spots);
        option.disabled = spots <= 0;
        if (role === currentValue && spots > 0) option.selected = true;
        select.appendChild(option);
      });
    }

    updateRoleOptions();

    document.addEventListener('DOMContentLoaded', () => {
      if (!config.showWelcome) {
        document.getElementById('welcome').style.display = 'none';
        document.getElementById('join-card').classList.add('visible');
      } else {
        setTimeout(() => {
          document.getElementById('welcome').classList.add('hidden');
          setTimeout(() => {
            document.getElementById('welcome').style.display = 'none';
            document.getElementById('join-card').classList.add('visible');
          }, config.fadeOutMs + 100);
        }, config.welcomeVisibleMs);
      }

      const form = document.getElementById('joinForm');
      const submitBtn = document.getElementById('submitBtn');
      const spinner = document.getElementById('loadingSpinner');
      const fileInput = document.getElementById('cv');
      const dropArea = document.getElementById('fileDropArea');
      const fileInfo = document.getElementById('fileInfo');
      const fileNameSize = document.getElementById('fileNameSize');
      const removeFileBtn = document.getElementById('removeFile');

      const validators = {
        name:     v => v.trim().length >= 2 ? '' : 'Please enter your full name',
        email:    v => !v.trim() ? 'Email is required' : !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v) ? 'Invalid email' : '',
        phone:    v => !v.trim() || /^\+?\d{7,15}$/.test(v.replace(/[\s()-]/g,'')) ? '' : 'Invalid phone format',
        role:     v => v ? '' : 'Please select a position',
        location: v => v ? '' : 'Please select deployment location',
        cv:       (v) => {
          if (!fileInput.files?.length) return ''; // optional → no error
          const f = fileInput.files[0];
          const ext = f.name.split('.').pop().toLowerCase();
          if (!config.allowedExtensions.includes(ext)) return `Only PDF, DOC, DOCX allowed`;
          if (f.size > config.maxFileSize) return 'File too large (max 5 MB)';
          return '';
        },
        message:  () => ''
      };

      function validateField(field) {
        const el = document.getElementById(field);
        const wrapper = el.closest('.input-wrapper');
        const errEl = document.getElementById(`${field}-error`);
        let msg = '';

        if (field === 'cv') {
          msg = validators.cv();
        } else {
          msg = validators[field](el.value);
        }

        wrapper.classList.remove('valid','invalid');
        errEl.classList.remove('show');
        errEl.textContent = '';

        if (msg) {
          wrapper.classList.add('invalid');
          errEl.textContent = msg;
          errEl.classList.add('show');
          return false;
        } else if ((field !== 'message' && el.value.trim()) || (field === 'cv' && fileInput.files.length)) {
          wrapper.classList.add('valid');
        }
        return true;
      }

      ['name','email','phone','role','message','location'].forEach(f => {
        const input = document.getElementById(f);
        if (input) {
          input.addEventListener('input', () => validateField(f));
          input.addEventListener('blur',   () => validateField(f));
        }
      });

      // CV validation only when file is selected
      fileInput.addEventListener('change', () => validateField('cv'));

      window.toggleOtherLocation = function() {
        const select = document.getElementById('location');
        const otherDiv = document.querySelector('[data-field="other-location"]');
        if (select.value === 'Other') {
          otherDiv.style.display = 'block';
          document.getElementById('other-location-input').setAttribute('required', '');
        } else {
          otherDiv.style.display = 'none';
          document.getElementById('other-location-input').removeAttribute('required');
        }
      };

      function showFile(file) {
        const size = (file.size / 1024).toFixed(1);
        fileNameSize.textContent = `${file.name} (${size} KB)`;
        fileInfo.classList.remove('hidden');
        validateField('cv');
      }

      dropArea.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', e => {
        if (e.target.files[0]) showFile(e.target.files[0]);
      });

      removeFileBtn.addEventListener('click', () => {
        fileInput.value = '';
        fileInfo.classList.add('hidden');
        validateField('cv');
      });

      ['dragover','dragenter'].forEach(e => dropArea.addEventListener(e, ev => {
        ev.preventDefault(); dropArea.classList.add('dragover');
      }));

      ['dragleave','drop'].forEach(e => dropArea.addEventListener(e, ev => {
        ev.preventDefault(); dropArea.classList.remove('dragover');
        if (e === 'drop' && ev.dataTransfer?.files?.[0]) {
          fileInput.files = ev.dataTransfer.files;
          showFile(ev.dataTransfer.files[0]);
        }
      }));

      form.addEventListener('submit', async e => {
        e.preventDefault();

        let valid = true;
        ['name','email','phone','role','location','message'].forEach(f => {
          if (!validateField(f)) valid = false;
        });

        // CV is optional, but if uploaded → must be valid
        if (!validateField('cv')) valid = false;

        const locationSelect = document.getElementById('location');
        if (locationSelect.value === 'Other') {
          const otherInput = document.getElementById('other-location-input');
          if (!otherInput.value.trim()) {
            document.getElementById('other-location-error').textContent = 'Please specify the location';
            document.getElementById('other-location-error').classList.add('show');
            valid = false;
          }
        }

        if (!valid) {
          form.classList.add('shake');
          setTimeout(() => form.classList.remove('shake'), 600);
          return;
        }

        const selectedRole = document.getElementById('role').value;

        submitBtn.disabled = true;
        spinner.classList.add('active');
        submitBtn.textContent = 'Sending...';

        try {
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
          });

          if (response.ok) {
            if (roleSpots[selectedRole] > 0) {
              roleSpots[selectedRole]--;
              updateRoleOptions(selectedRole);
            }

            alert(`Thank you!\nYour application for ${selectedRole} has been received.` +
                  (fileInput.files.length ? "\nCV attached." : "\n(No CV attached)") +
                  `\nSpots left: ${roleSpots[selectedRole] || 0}/4`);

            form.reset();
            fileInfo.classList.add('hidden');
            spinner.classList.remove('active');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Application';
          } else {
            throw new Error(await response.text() || 'Submission failed');
          }
        } catch (err) {
          let msg = "There was a problem sending your application.";
          if (err.message.includes('file') || err.message.includes('upload')) {
            msg += "\n→ File upload may not be supported on the free plan";
          } else if (err.message.includes('limit')) {
            msg += "\n→ Monthly submission limit may have been reached";
          }
          alert(msg + "\nPlease try again or check your Formspree dashboard.");
          spinner.classList.remove('active');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
        }
      });
    });
  </script>
</body>
</html>